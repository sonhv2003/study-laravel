/* http://keith-wood.name/countdown.html
   Countdown for jQuery v1.5.8.
   Written by Keith Wood (kbwood{at}iinet.com.au) January 2008.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses.
   Please attribute the author if you use it. */
(function(i){function q(){this.regional=[];this.regional[""]={labels:["Years","Months","Weeks","Days","Hours","Minutes","Seconds"],labels1:["Year","Month","Week","Day","Hour","Minute","Second"],compactLabels:["y","m","w","d"],whichLabels:null,timeSeparator:":",isRTL:false};this._defaults={until:null,since:null,timezone:null,serverSync:null,format:"dHMS",layout:"",compact:false,significant:0,description:"",expiryUrl:"",expiryText:"",alwaysExpire:false,onExpiry:null,onTick:null,tickInterval:1};i.extend(this._defaults,
this.regional[""]);this._serverSyncs=[]}function r(a,b){i.extend(a,b);for(var c in b)if(b[c]==null)a[c]=null;return a}i.extend(q.prototype,{markerClassName:"hasCountdown",_timer:setInterval(function(){i.countdown._updateTargets()},980),_timerTargets:[],setDefaults:function(a){this._resetExtraLabels(this._defaults,a);r(this._defaults,a||{})},UTCDate:function(a,b,c,d,g,f,e,k){if(typeof b=="object"&&b.constructor==Date){k=b.getMilliseconds();e=b.getSeconds();f=b.getMinutes();g=b.getHours();d=b.getDate();
c=b.getMonth();b=b.getFullYear()}var j=new Date;j.setUTCFullYear(b);j.setUTCDate(1);j.setUTCMonth(c||0);j.setUTCDate(d||1);j.setUTCHours(g||0);j.setUTCMinutes((f||0)-(Math.abs(a)<30?a*60:a));j.setUTCSeconds(e||0);j.setUTCMilliseconds(k||0);return j},periodsToSeconds:function(a){return a[0]*31557600+a[1]*2629800+a[2]*604800+a[3]*86400+a[4]*3600+a[5]*60+a[6]},_settingsCountdown:function(a,b){if(!b)return i.countdown._defaults;a=i.data(a,"countdown");return b=="all"?a.options:a.options[b]},_attachCountdown:function(a,
b){var c=i(a);if(!c.hasClass(this.markerClassName)){c.addClass(this.markerClassName);b={options:i.extend({},b),_periods:[0,0,0,0,0,0,0]};i.data(a,"countdown",b);this._changeCountdown(a)}},_addTarget:function(a){this._hasTarget(a)||this._timerTargets.push(a)},_hasTarget:function(a){return i.inArray(a,this._timerTargets)>-1},_removeTarget:function(a){this._timerTargets=i.map(this._timerTargets,function(b){return b==a?null:b})},_updateTargets:function(){for(var a=this._timerTargets.length-1;a>=0;a--)this._updateCountdown(this._timerTargets[a])},
_updateCountdown:function(a,b){var c=i(a);if(b=b||i.data(a,"countdown")){c.html(this._generateHTML(b));c[(this._get(b,"isRTL")?"add":"remove")+"Class"]("countdown_rtl");if(c=this._get(b,"onTick")){var d=b._hold!="lap"?b._periods:this._calculatePeriods(b,b._show,this._get(b,"significant"),new Date),g=this._get(b,"tickInterval");if(g==1||this.periodsToSeconds(d)%g==0)c.apply(a,[d])}if(b._hold!="pause"&&(b._since?b._now.getTime()<b._since.getTime():b._now.getTime()>=b._until.getTime())&&!b._expiring){b._expiring=
true;if(this._hasTarget(a)||this._get(b,"alwaysExpire")){this._removeTarget(a);(c=this._get(b,"onExpiry"))&&c.apply(a,[]);if(c=this._get(b,"expiryText")){d=this._get(b,"layout");b.options.layout=c;this._updateCountdown(a,b);b.options.layout=d}if(c=this._get(b,"expiryUrl"))window.location=c}b._expiring=false}else b._hold=="pause"&&this._removeTarget(a);i.data(a,"countdown",b)}},_changeCountdown:function(a,b,c){b=b||{};if(typeof b=="string"){var d=b;b={};b[d]=c}if(c=i.data(a,"countdown")){this._resetExtraLabels(c.options,
b);r(c.options,b);this._adjustSettings(a,c);i.data(a,"countdown",c);b=new Date;if(c._since&&c._since<b||c._until&&c._until>b)this._addTarget(a);this._updateCountdown(a,c)}},_resetExtraLabels:function(a,b){var c=false;for(var d in b)if(d!="whichLabels"&&d.match(/[Ll]abels/)){c=true;break}if(c)for(d in a)if(d.match(/[Ll]abels[0-9]/))a[d]=null},_adjustSettings:function(a,b){var c=this._get(b,"serverSync"),d=0;d=null;for(var g=0;g<this._serverSyncs.length;g++)if(this._serverSyncs[g][0]==c){d=this._serverSyncs[g][1];
break}if(d!=null){d=c?d:0;a=new Date}else{d=c?c.apply(a,[]):null;a=new Date;d=d?a.getTime()-d.getTime():0;this._serverSyncs.push([c,d])}c=this._get(b,"timezone");c=c==null?-a.getTimezoneOffset():c;b._since=this._get(b,"since");if(b._since!=null){b._since=this.UTCDate(c,this._determineTime(b._since,null));b._since&&d&&b._since.setMilliseconds(b._since.getMilliseconds()+d)}b._until=this.UTCDate(c,this._determineTime(this._get(b,"until"),a));d&&b._until.setMilliseconds(b._until.getMilliseconds()+d);
b._show=this._determineShow(b)},_destroyCountdown:function(a){var b=i(a);if(b.hasClass(this.markerClassName)){this._removeTarget(a);b.removeClass(this.markerClassName).empty();i.removeData(a,"countdown")}},_pauseCountdown:function(a){this._hold(a,"pause")},_lapCountdown:function(a){this._hold(a,"lap")},_resumeCountdown:function(a){this._hold(a,null)},_hold:function(a,b){var c=i.data(a,"countdown");if(c){if(c._hold=="pause"&&!b){c._periods=c._savePeriods;var d=c._since?"-":"+";c[c._since?"_since":
"_until"]=this._determineTime(d+c._periods[0]+"y"+d+c._periods[1]+"o"+d+c._periods[2]+"w"+d+c._periods[3]+"d"+d+c._periods[4]+"h"+d+c._periods[5]+"m"+d+c._periods[6]+"s");this._addTarget(a)}c._hold=b;c._savePeriods=b=="pause"?c._periods:null;i.data(a,"countdown",c);this._updateCountdown(a,c)}},_getTimesCountdown:function(a){a=i.data(a,"countdown");return!a?null:!a._hold?a._periods:this._calculatePeriods(a,a._show,this._get(a,"significant"),new Date)},_get:function(a,b){return a.options[b]!=null?a.options[b]:
i.countdown._defaults[b]},_determineTime:function(a,b){var c=function(g){var f=new Date;f.setTime(f.getTime()+g*1E3);return f},d=function(g){g=g.toLowerCase();var f=new Date,e=f.getFullYear(),k=f.getMonth(),j=f.getDate(),h=f.getHours(),m=f.getMinutes();f=f.getSeconds();for(var n=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g,l=n.exec(g);l;){switch(l[2]||"s"){case "s":f+=parseInt(l[1],10);break;case "m":m+=parseInt(l[1],10);break;case "h":h+=parseInt(l[1],10);break;case "d":j+=parseInt(l[1],10);break;case "w":j+=
parseInt(l[1],10)*7;break;case "o":k+=parseInt(l[1],10);j=Math.min(j,i.countdown._getDaysInMonth(e,k));break;case "y":e+=parseInt(l[1],10);j=Math.min(j,i.countdown._getDaysInMonth(e,k));break}l=n.exec(g)}return new Date(e,k,j,h,m,f,0)};(a=a==null?b:typeof a=="string"?d(a):typeof a=="number"?c(a):a)&&a.setMilliseconds(0);return a},_getDaysInMonth:function(a,b){return 32-(new Date(a,b,32)).getDate()},_normalLabels:function(a){return a},_generateHTML:function(a){var b=this._get(a,"significant");a._periods=
a._hold?a._periods:this._calculatePeriods(a,a._show,b,new Date);for(var c=false,d=0,g=b,f=i.extend({},a._show),e=0;e<=6;e++){c|=a._show[e]=="?"&&a._periods[e]>0;f[e]=a._show[e]=="?"&&!c?null:a._show[e];d+=f[e]?1:0;g-=a._periods[e]>0?1:0}var k=[false,false,false,false,false,false,false];for(e=6;e>=0;e--)if(a._show[e])if(a._periods[e])k[e]=true;else{k[e]=g>0;g--}c=this._get(a,"compact");g=this._get(a,"layout");var j=c?this._get(a,"compactLabels"):this._get(a,"labels"),h=this._get(a,"whichLabels")||
this._normalLabels;e=this._get(a,"timeSeparator");var m=this._get(a,"description")||"",n=function(o){var p=i.countdown._get(a,"compactLabels"+h(a._periods[o]));return f[o]?a._periods[o]+(p?p[o]:j[o])+" ":""},l=function(o){var p=i.countdown._get(a,"labels"+h(a._periods[o]));return!b&&f[o]||b&&k[o]?'<span class="countdown_section"><span class="countdown_amount">'+a._periods[o]+"</span><br/>"+(p?p[o]:j[o])+"</span>":""};return g?this._buildLayout(a,f,g,c,b,k):(c?'<span class="countdown_row countdown_amount'+
(a._hold?" countdown_holding":"")+'">'+n(0)+n(1)+n(2)+n(3)+(f[4]?this._minDigits(a._periods[4],2):"")+(f[5]?(f[4]?e:"")+this._minDigits(a._periods[5],2):"")+(f[6]?(f[4]||f[5]?e:"")+this._minDigits(a._periods[6],2):""):'<span class="countdown_row countdown_show'+(b||d)+(a._hold?" countdown_holding":"")+'">'+l(0)+l(1)+l(2)+l(3)+l(4)+l(5)+l(6))+"</span>"+(m?'<span class="countdown_row countdown_descr">'+m+"</span>":"")},_buildLayout:function(a,b,c,d,g,f){var e=this._get(a,d?"compactLabels":"labels"),
k=this._get(a,"whichLabels")||this._normalLabels,j=function(n){return(i.countdown._get(a,(d?"compactLabels":"labels")+k(a._periods[n]))||e)[n]},h=function(n,l){return Math.floor(n/l)%10};j={desc:this._get(a,"description"),sep:this._get(a,"timeSeparator"),yl:j(0),yn:a._periods[0],ynn:this._minDigits(a._periods[0],2),ynnn:this._minDigits(a._periods[0],3),y1:h(a._periods[0],1),y10:h(a._periods[0],10),y100:h(a._periods[0],100),y1000:h(a._periods[0],1E3),ol:j(1),on:a._periods[1],onn:this._minDigits(a._periods[1],
2),onnn:this._minDigits(a._periods[1],3),o1:h(a._periods[1],1),o10:h(a._periods[1],10),o100:h(a._periods[1],100),o1000:h(a._periods[1],1E3),wl:j(2),wn:a._periods[2],wnn:this._minDigits(a._periods[2],2),wnnn:this._minDigits(a._periods[2],3),w1:h(a._periods[2],1),w10:h(a._periods[2],10),w100:h(a._periods[2],100),w1000:h(a._periods[2],1E3),dl:j(3),dn:a._periods[3],dnn:this._minDigits(a._periods[3],2),dnnn:this._minDigits(a._periods[3],3),d1:h(a._periods[3],1),d10:h(a._periods[3],10),d100:h(a._periods[3],
100),d1000:h(a._periods[3],1E3),hl:j(4),hn:a._periods[4],hnn:this._minDigits(a._periods[4],2),hnnn:this._minDigits(a._periods[4],3),h1:h(a._periods[4],1),h10:h(a._periods[4],10),h100:h(a._periods[4],100),h1000:h(a._periods[4],1E3),ml:j(5),mn:a._periods[5],mnn:this._minDigits(a._periods[5],2),mnnn:this._minDigits(a._periods[5],3),m1:h(a._periods[5],1),m10:h(a._periods[5],10),m100:h(a._periods[5],100),m1000:h(a._periods[5],1E3),sl:j(6),sn:a._periods[6],snn:this._minDigits(a._periods[6],2),snnn:this._minDigits(a._periods[6],
3),s1:h(a._periods[6],1),s10:h(a._periods[6],10),s100:h(a._periods[6],100),s1000:h(a._periods[6],1E3)};var m=c;for(c=0;c<=6;c++){h="yowdhms".charAt(c);m=m.replace(new RegExp("\\{"+h+"<\\}(.*)\\{"+h+">\\}","g"),!g&&b[c]||g&&f[c]?"$1":"")}i.each(j,function(n,l){m=m.replace(new RegExp("\\{"+n+"\\}","g"),l)});return m},_minDigits:function(a,b){a=""+a;if(a.length>=b)return a;a="0000000000"+a;return a.substr(a.length-b)},_determineShow:function(a){a=this._get(a,"format");var b=[];b[0]=a.match("y")?"?":
a.match("Y")?"!":null;b[1]=a.match("o")?"?":a.match("O")?"!":null;b[2]=a.match("w")?"?":a.match("W")?"!":null;b[3]=a.match("d")?"?":a.match("D")?"!":null;b[4]=a.match("h")?"?":a.match("H")?"!":null;b[5]=a.match("m")?"?":a.match("M")?"!":null;b[6]=a.match("s")?"?":a.match("S")?"!":null;return b},_calculatePeriods:function(a,b,c,d){a._now=d;a._now.setMilliseconds(0);var g=new Date(a._now.getTime());if(a._since)if(d.getTime()<a._since.getTime())a._now=d=g;else d=a._since;else{g.setTime(a._until.getTime());
if(d.getTime()>a._until.getTime())a._now=d=g}var f=[0,0,0,0,0,0,0];if(b[0]||b[1]){var e=i.countdown._getDaysInMonth(d.getFullYear(),d.getMonth()),k=i.countdown._getDaysInMonth(g.getFullYear(),g.getMonth());k=g.getDate()==d.getDate()||g.getDate()>=Math.min(e,k)&&d.getDate()>=Math.min(e,k);var j=function(m){return(m.getHours()*60+m.getMinutes())*60+m.getSeconds()};k=Math.max(0,(g.getFullYear()-d.getFullYear())*12+g.getMonth()-d.getMonth()+(g.getDate()<d.getDate()&&!k||k&&j(g)<j(d)?-1:0));f[0]=b[0]?
Math.floor(k/12):0;f[1]=b[1]?k-f[0]*12:0;d=new Date(d.getTime());e=d.getDate()==e;k=i.countdown._getDaysInMonth(d.getFullYear()+f[0],d.getMonth()+f[1]);d.getDate()>k&&d.setDate(k);d.setFullYear(d.getFullYear()+f[0]);d.setMonth(d.getMonth()+f[1]);e&&d.setDate(k)}var h=Math.floor((g.getTime()-d.getTime())/1E3);d=function(m,n){f[m]=b[m]?Math.floor(h/n):0;h-=f[m]*n};d(2,604800);d(3,86400);d(4,3600);d(5,60);d(6,1);if(h>0&&!a._since){a=[1,12,4.3482,7,24,60,60];d=6;g=1;for(e=6;e>=0;e--){if(b[e]){if(f[d]>=
g){f[d]=0;h=1}if(h>0){f[e]++;h=0;d=e;g=1}}g*=a[e]}}if(c)for(e=0;e<=6;e++)if(c&&f[e])c--;else c||(f[e]=0);return f}});i.fn.countdown=function(a){var b=Array.prototype.slice.call(arguments,1);if(a=="getTimes"||a=="settings")return i.countdown["_"+a+"Countdown"].apply(i.countdown,[this[0]].concat(b));return this.each(function(){typeof a=="string"?i.countdown["_"+a+"Countdown"].apply(i.countdown,[this].concat(b)):i.countdown._attachCountdown(this,a)})};i.countdown=new q})(jQuery);
